<!DOCTYPE html>
<meta charset="utf-8">
<style>
  body {
    font: 10px sans-serif;
  }

  .axis path,
  .axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
  }

  .x.axis path {
    display: none;
  }

  .line {
    fill: rgb(238, 135, 135);
    stroke: rgb(186, 27, 6);
    stroke-width: 1.5px;
  }
</style>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>



</head>

<body style="width: 100%">
  <script src="//d3js.org/d3.v4.min.js"></script>
  <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>

  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/locale/af.js"></script> -->

  <script type="text/javascript">
    d3.csv("HealthSecs.csv", function(data) {
      data.forEach(function(d) {
        // d.Name = +d.Name;
        d["Duration in Months"] = +d["Duration in Months"];
      });

      console.log(data[0].In);

      var config = {
        width: 1100,
        height: 400
      }
      var padding = 10;

      var parseDate = d3.timeFormat("%d-%m-%Y")


      var svg = d3.select("#viz").append("svg")
        .attr("id", "timeline")
        .attr("width", config.width)
        .attr("height", config.height)
        .append("g")

      var dateScale = d3.scaleTime()
        .domain([new Date(data[1].In), new Date()])
        .range([0, 900]);

      // console.log(data[2].Out)
      //
      // console.log(dateScale(new Date(data[2].Out)))
      // console.log(dateScale(new Date(data[2].In)))
      //
      // var widthOfBox = dateScale(new Date(data[2].Out)) - dateScale(new Date(data[2].In))
      //
      // console.log(widthOfBox)

      var previousDate;
      var previousX = 0;

      svg.selectAll("#bar")
        .data(data)
        .enter().append("rect")
        .attr("class", "bar")
        .attr("id", function(d) {
          return (d.Name).replace(/ /g,'').replace(/\./g,'')
        })
        .attr("x", function(d, i) {
          if (i != 0) {
            previousDate = new Date(data[i - 1].In)
            newX = Math.abs(dateScale(new Date(d.In)) - dateScale(previousDate))
          } else {
            previousDate = new Date(data[1].In)
            newX = 0;
          }
          previousX = previousX + newX;
          return previousX;
        })
        .attr("y", function(d) {
          return 200;
        })
        .attr("width", function(d) {
          return Math.abs(dateScale(new Date(d.In)) - dateScale(new Date(d.Out)))
        })
        .attr("height", 20);
      // .attr("fill", "blue")

      previousX = 0;

      var texts = svg.selectAll("text")
        .data(data)
        .enter();

      texts.append("text")
        .text(function(d) {
          return d.Name;
        })
        .attr("class", function(d) {
          return (d.Name).replace(/ /g,'').replace(/\./g,'')
        })
        .attr("y", function(d, i) {
          if (d.Name == "Prasanna K. Hota" || d.Name == "K. Chandramouli" || d.Name == "Anil Kumar" || d.Name == "Lov Verma") {
            return 155;
          } else {
            return 180;

          }

        })
        .attr("x", function(d, i) {
          if (i != 0) {
            previousDate = new Date(data[i - 1].In)
            newX = Math.abs(dateScale(new Date(d.In)) - dateScale(previousDate))
          } else {
            previousDate = new Date(data[1].In)
            newX = 0;
          }
          previousX = previousX + newX;
          return previousX;
        })
        .attr("font-size", 12)
        .attr("font-family", "Gotham HTF")
        .attr("text-anchor", "start")
        .attr("font-weight", "bold");

        previousX = 0;

        texts.append("text")
          .text(function(d) {
            return "In: " + d.In;
          })
          .attr("class", function(d) {
            return (d.Name).replace(/ /g,'').replace(/\./g,'')
          })
          .attr("y", function(d, i) {
              return 250;
          })
          .attr("x", function(d, i) {
            if (i != 0) {
              previousDate = new Date(data[i - 1].In)
              newX = Math.abs(dateScale(new Date(d.In)) - dateScale(previousDate))
            } else {
              previousDate = new Date(data[1].In)
              newX = 0;
            }
            previousX = previousX + newX;
            return previousX;
          })
          .attr("font-size", 12)
          .attr("font-family", "Gotham HTF")
          .attr("text-anchor", "start")
          .attr("opacity", "1")
          // .attr("font-weight", "bold");

          previousX = 0;

          texts.append("text")
            .text(function(d) {
              return "Previous: " + d["Previous Department"];
            })
            .attr("class", function(d) {
              return (d.Name).replace(/ /g,'').replace(/\./g,'')
            })
            .attr("y", function(d, i) {
                return 270;
            })
            .attr("x", function(d, i) {
              if (i != 0) {
                previousDate = new Date(data[i - 1].In)
                newX = Math.abs(dateScale(new Date(d.In)) - dateScale(previousDate))
              } else {
                previousDate = new Date(data[1].In)
                newX = 0;
              }
              previousX = previousX + newX;
              return previousX;
            })
            .attr("font-size", 12)
            .attr("font-family", "Gotham HTF")
            .attr("text-anchor", "start")
            .attr("opacity", "1")
            // .attr("font-weight", "bold");


            previousX = 0;

            texts.append("text")
              .text(function(d) {
                return "Out: " + d.Out;
              })
              .attr("class", function(d) {
                return (d.Name).replace(/ /g,'').replace(/\./g,'')
              })
              .attr("y", function(d, i) {
                  return 290;
              })
              .attr("x", function(d, i) {
                if (i != 0) {
                  previousDate = new Date(data[i - 1].In)
                  newX = Math.abs(dateScale(new Date(d.In)) - dateScale(previousDate))
                } else {
                  previousDate = new Date(data[1].In)
                  newX = 0;
                }
                previousX = previousX + newX;
                return previousX;
              })
              .attr("font-size", 12)
              .attr("font-family", "Gotham HTF")
              .attr("text-anchor", "start")
              .attr("opacity", "1")
              // .attr("font-weight", "bold");

              previousX = 0;

              texts.append("text")
                .text(function(d) {
                  return "Later: " + d["Later"];
                })
                .attr("class", function(d) {
                  return (d.Name).replace(/ /g,'').replace(/\./g,'')
                })
                .attr("y", function(d, i) {
                    return 310;
                })
                .attr("x", function(d, i) {
                  if (i != 0) {
                    previousDate = new Date(data[i - 1].In)
                    newX = Math.abs(dateScale(new Date(d.In)) - dateScale(previousDate))
                  } else {
                    previousDate = new Date(data[1].In)
                    newX = 0;
                  }
                  previousX = previousX + newX;
                  return previousX;
                })
                .attr("font-size", 12)
                .attr("font-family", "Gotham HTF")
                .attr("text-anchor", "start")
                .attr("opacity", "1")
                // .attr("font-weight", "bold");








    });
  </script>



  <div id="viz" style="margin: 0 auto; width: 1100px;">
  </div>

  <style>
    .bar {
      fill: #FF3029;
      stroke: white;
      stroke-width: 1px;
    }
  </style>

</body>
